<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TLFloat: TLFloat - C++ template library for floating point operations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TLFloat
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TLFloat - C++ template library for floating point operations </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> Original distribution site : <a href="https://github.com/shibatch/tlfloat">https://github.com/shibatch/tlfloat</a></p>
<p>Doxygen-generated reference : <a href="https://shibatch.sourceforge.net/tlfloat-doxygen/">https://shibatch.sourceforge.net/tlfloat-doxygen/</a></p>
<h2><a class="anchor" id="autotoc_md1"></a>
Introduction</h2>
<p>This library implements C++ classes with which half, single, double, quadruple and octuple precision IEEE 754 floating point numbers can be operated.</p>
<p>Internally, these classes are implemented as class templates on top of arbitrary-precision integer class templates so that the templates are expanded as arbitrary precision floating-point operations by just changing the template parameters, rather than implementing each floating-point operation for each precision. The arbitrary-precision integer class templates are also included in this library.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Features</h2>
<ul>
<li>Truly constexpr functions<ul>
<li>Compilable with C++20 standard</li>
<li>Most of the functions are implemented as templates<ul>
<li>Completely inlinable functions</li>
<li>The functions can be evaluated at compile time</li>
</ul>
</li>
<li>No malloc required</li>
<li>Works without libstdc++</li>
</ul>
</li>
<li>IEEE 754 compliant<ul>
<li>Supports subnormal numbers, NaN, infinity, and signed zero</li>
</ul>
</li>
<li>Supports a wide range of precisions<ul>
<li>Half, float, double, quad, and octuple precisions</li>
<li>Returns correctly rounded results for arithmetic oprations, fma and sqrt</li>
<li>Returns 1-ulp accuracy results for other math.h functions<ul>
<li>All functions, including trigonometric functions, return 1ulp-accuracy results for all input range</li>
</ul>
</li>
</ul>
</li>
<li>Portable<ul>
<li>Compatible with Linux, Windows, microcontrollers, wasm, CUDA (version 12 or later)</li>
<li>Constexpr functions can be called from CUDA devices with &ndash;expt-relaxed-constexpr compiler option</li>
</ul>
</li>
<li>C/C++11 API with libquadmath emulation<ul>
<li>Most of libquadmath functions can be used on x86_64 clang and MSVC</li>
<li>128-bit integer types can be used on MSVC</li>
<li>C++11 FP and int classes with overloaded operators are provided<ul>
<li>C++11 functions in TLFloat are not constexpr</li>
</ul>
</li>
</ul>
</li>
<li>Moderately optimized<ul>
<li>Optimized for each architecture using intrinsics, etc.</li>
<li>Library design allows compilers to fully inline operations</li>
<li>All functions are thread-safe and reentrant</li>
</ul>
</li>
<li>Implements most of the math.h functions<ul>
<li>Arithmetic operations, comparison, cast operations</li>
<li>fma, sqrt, hypot, cbrt, fmod, remainder, remquo</li>
<li>sin, cos, tan, sinpi, cospi, tanpi</li>
<li>asin, acos, atan, atan2</li>
<li>log, log2, log10, log1p</li>
<li>exp, exp2, exp10, expm1, pow</li>
<li>sinh, cosh, tanh, asinh, acosh, atanh</li>
<li>erf, erfc, tgamma</li>
<li>trunc, floor, ceil, round, rint</li>
<li>fabs, copysign, fmax, fmin, fdim</li>
<li>ldexp, frexp, modf, nextafter</li>
<li>isnan, isinf, finite, fpclassify, signbit</li>
</ul>
</li>
<li>Implements I/O functions<ul>
<li>Conversion to/from C strings</li>
<li>printf-family functions</li>
</ul>
</li>
<li>Provides BigInt template classes in addition to the FP classes<ul>
<li>It provides operations for integers of artibrary length (2^N bits)</li>
<li>They can be used in the similar way to the ordinary int/uint types</li>
<li>Data formats are the same as ordinary int/uint</li>
<li>These classes are internally used to implement the FP classes in TLFloat</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
How to build</h2>
<ol type="1">
<li>Check out the source code from our GitHub repository : <code>git clone <a href="https://github.com/shibatch/tlfloat">https://github.com/shibatch/tlfloat</a></code></li>
<li>Make a separate directory to create an out-of-source build : <code>cd tlfloat &amp;&amp; mkdir build &amp;&amp; cd build</code></li>
<li>Run cmake to configure the project : <code>cmake .. -DCMAKE_INSTALL_PREFIX=../../install</code></li>
<li>Run make to build and install the project : <code>make &amp;&amp; make install</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md4"></a>
Compiling hello world example</h2>
<p>Below is a simple C++ source code utilizing TLFloat.</p>
<div class="fragment"><div class="line">#include &lt;iostream&gt;</div>
<div class="line">#include &lt;iomanip&gt;</div>
<div class="line">#include &lt;tlfloat/tlmath.hpp&gt;</div>
<div class="line"> </div>
<div class="line">using namespace tlfloat;</div>
<div class="line"> </div>
<div class="line">Octuple machin() {</div>
<div class="line">  return 4 * (4 * atan(1 / Octuple(5)) - atan(1 / Octuple(239)));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int main(int argc, char **argv) {</div>
<div class="line">  std::cout &lt;&lt; std::setprecision(70) &lt;&lt; machin() &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To compile this source code, use the following command.</p>
<p><code>g++ -std=c++20 -I./install/include hello.cpp</code></p>
<p>You have to specify C++20 standard. Note that you do not need to link any library in this example. This program computes PI in octuple precision and shows it.</p>
<div class="fragment"><div class="line">$ ./a.out</div>
<div class="line">3.141592653589793238462643383279502884197169399375105820974944592307816</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Libquadmath emulation</h2>
<p>In gcc/g++ on x86_64 architecture, libquadmath provides math functions for quadruple precision floating point numbers. However, libquadmath is not available with clang or Visual Studio. By using the libquadmath emulation feature of TLFloat library, it is possible to use most of the features of libquadmath with clang and Visual Studio.</p>
<p>Below is a simple C source code utilizing this feature.</p>
<div class="fragment"><div class="line">#include &lt;stdio.h&gt;</div>
<div class="line">#include &lt;stdlib.h&gt;</div>
<div class="line"> </div>
<div class="line">#define TLFLOAT_LIBQUADMATH_EMULATION</div>
<div class="line">#include &lt;tlfloat/tlfloat.h&gt;</div>
<div class="line"> </div>
<div class="line">int main(int argc, char **argv) {</div>
<div class="line">  if (argc &lt; 3) exit(-1);</div>
<div class="line"> </div>
<div class="line">  __float128 q1 = strtoflt128(argv[1], NULL);</div>
<div class="line">  __float128 q2 = strtoflt128(argv[2], NULL);</div>
<div class="line"> </div>
<div class="line">  char str[256];</div>
<div class="line">  quadmath_snprintf(str, sizeof(str), &quot;%.30Qg&quot;, powq(q1, q2));</div>
<div class="line">  puts(str);</div>
<div class="line">}</div>
</div><!-- fragment --><p>To compile this source code, use the following command.</p>
<p><code>clang quad.c -I./install/include -L./install/lib -ltlfloat -lm</code></p>
<p>Below is an example of executing this program.</p>
<div class="fragment"><div class="line">$ ./a.out 1.234 2.345</div>
<div class="line">1.63732181977903314975233575019</div>
</div><!-- fragment --><p>In order to use the libquadmath emulation feature, define TLFLOAT_LIBQUADMATH_EMULATION macro, include <a class="el" href="tlfloat_8h.html">tlfloat/tlfloat.h</a> instead of quadmath.h, and link with -ltlfloat -lm. If you need portability, replace __float128 with <a class="el" href="structtlfloat__quad.html">tlfloat_quad</a>.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
C++11 API</h2>
<p>Besides the C++20 API, TLFloat provides classes that can be used with C++11 standard.</p>
<p>Below is a simple C++ source code utilizing this feature.</p>
<div class="fragment"><div class="line">#include &lt;iostream&gt;</div>
<div class="line">#include &lt;tlfloat/tlfloat.h&gt;</div>
<div class="line"> </div>
<div class="line">tlfloat_octuple AGM(int N) {</div>
<div class="line">  tlfloat_octuple y = tlfloat_sqrto(2) - 1;</div>
<div class="line">  tlfloat_octuple a = y * y * 2;</div>
<div class="line"> </div>
<div class="line">  for(int k=0;k&lt;N;k++) {</div>
<div class="line">    y = 1.0 - tlfloat_powo(y, 4);</div>
<div class="line">    y = tlfloat_powo(y, 1.0/4);</div>
<div class="line">    y = (1 - y) / (1 + y);</div>
<div class="line">    a *= tlfloat_powo(1 + y, 4);</div>
<div class="line">    a -= tlfloat_ldexpo(((y + 1) * y + 1) * y, 2 * k + 3);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  return 1 / a;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int main(int argc, char **argv) {</div>
<div class="line">  std::cout &lt;&lt; tlfloat::to_string(AGM(3), 70) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To compile this source code, use the following command.</p>
<p><code>g++ cpp11.cpp -std=c++11 -I./install/include -L./install/lib -ltlfloat</code></p>
<p>Below is an example of executing this program.</p>
<div class="fragment"><div class="line">$ ./a.out</div>
<div class="line">3.141592653589793238462643383279502884197169399375105820974944592307818</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Benchmark results</h2>
<p>This software package includes a benchmark tool. This can be built by specifying <code>-DBUILD_BENCH=True</code> cmake option. Below are some results of the benchmarks.</p>
<p>CPU: AMD Ryzen 9 7950X (running at 4.5GHz)</p>
<p>Compiler: gcc version 12.3.0 (Ubuntu 12.3.0-17ubuntu1)</p>
<p>TLFloat Quad</p>
<div class="fragment"><div class="line">TLFloat version      : 1.10.0</div>
<div class="line">Config               : tlfloat quad</div>
<div class="line">Measurement time     : 10 sec</div>
<div class="line">Addition             : 124.091 Mops/second</div>
<div class="line">Multiplication       : 99.8746 Mops/second</div>
<div class="line">Division             : 50.3795 Mops/second</div>
<div class="line">Cast to/from double  : 163.924 Mops/second</div>
<div class="line">Compare              : 296.318 Mops/second</div>
<div class="line">FMA                  : 67.8103 Mops/second</div>
<div class="line">Square root          : 15.7953 Mops/second</div>
<div class="line">Rint                 : 192.819 Mops/second</div>
<div class="line">Sin                  : 2.11886 Mops/second</div>
<div class="line">Atan                 : 1.30871 Mops/second</div>
<div class="line">Exp                  : 1.46121 Mops/second</div>
<div class="line">Log                  : 1.58222 Mops/second</div>
<div class="line">Pow                  : 0.887895 Mops/second</div>
</div><!-- fragment --><p>GNU libquadmath</p>
<div class="fragment"><div class="line">TLFloat version      : 1.10.0</div>
<div class="line">Config               : Libquadmath</div>
<div class="line">Measurement time     : 10 sec</div>
<div class="line">Addition             : 87.8567 Mops/second</div>
<div class="line">Multiplication       : 74.334 Mops/second</div>
<div class="line">Division             : 70.8784 Mops/second</div>
<div class="line">Cast to/from double  : 64.6601 Mops/second</div>
<div class="line">Compare              : 222.737 Mops/second</div>
<div class="line">FMA                  : 1.92256 Mops/second</div>
<div class="line">Square root          : 9.58719 Mops/second</div>
<div class="line">Rint                 : 40.1336 Mops/second</div>
<div class="line">Sin                  : 1.72235 Mops/second</div>
<div class="line">Atan                 : 2.87544 Mops/second</div>
<div class="line">Exp                  : 1.78155 Mops/second</div>
<div class="line">Log                  : 1.77996 Mops/second</div>
<div class="line">Pow                  : 1.27151 Mops/second</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Development plan</h2>
<ul>
<li>The following features will be added in future releases<ul>
<li>Further documentation</li>
<li>More testing<ul>
<li>Add more testers for I/O functions</li>
</ul>
</li>
<li>Interoperability with SLEEF</li>
<li>Remaining math functions in math.h</li>
<li>BF16 support</li>
<li>Further optimization</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
License</h2>
<p>The software is distributed under the Boost Software License, Version 1.0. See accompanying file LICENSE.txt or copy at : <a href="http://www.boost.org/LICENSE_1_0.txt">http://www.boost.org/LICENSE_1_0.txt</a>.</p>
<p>Contributions to this project are accepted under the same license.</p>
<p>The fact that this software is released under an open source license only means that you can use the current version of the software for free. If you want this software to be maintained, you need to financially support the project. Please see <a href="https://github.com/shibatch/nofreelunch?tab=coc-ov-file">CODE_OF_CONDUCT.md</a>.</p>
<p>Copyright Naoki Shibata 2024. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
<script type="text/javascript"> var sc_project=12992945; var sc_invisible=1; var sc_security="897faa49"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script><noscript><div class="statcounter"><a title="Web Analytics Made Easy - Statcounter" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12992945/0/897faa49/1/" alt="Web Analytics Made Easy - Statcounter" referrerPolicy="no-referrer-when-downgrade"></a></div></noscript> </body>
</html>
